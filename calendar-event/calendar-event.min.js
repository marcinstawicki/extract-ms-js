var MS=MS||{};
MS.CalendarEvent=function(){var c=this,l,m=function(){};c.setParent=function(g){l=g;return c};c.setUrl=function(g){return c};c.setResult=function(g){"function"!==typeof g&&(m=function(){});var n=l.getElementsByClassName("ce"),p=window.service.communication;(new MS.ForEach).setCollection(n).setResult(function(t,b){(new MS.Events).addBlur(b,function(d){var e=b.textContent.trim();if(""!==e){d=new Date;var u=b.getAttribute("data-o");if(e!==u)try{var q=new Date(e),h=q.getMinutes();if(isNaN(h))throw Error("input value has to be a valid date & time");if(0===
h||30===h)if(d.setHours(d.getHours()+2),q.getTime()>d.getTime()){var r=!1;(new MS.ForEach).setCollection(n).setResult(function(a,f){f=f.textContent.trim();if(t!==a&&e===f)return r=!0,!1});if(!0===r)throw Error("this date & time is already inserted in another box");var v=b.getAttribute("href"),k=new FormData;k.append("s",window.service.postHash);k.append("date",e);(new MS.XmlHttpRequest).unsetAsynchronous().setPostData(k).setUrl(v).setResult(function(a){if(!0===a.getResult()){if(null!==a.getSuccess()){var f=
a.getSuccess();b.setAttribute("href",f);b.setAttribute("data-o",e);m.call(this)}else null!==a.getFailure()&&alert(a.getFailure());window.service.postHash=a.getPostsHash()}else console.log(a.getResult())})}else throw Error("date & time have to be in the future");else throw Error("accepted increment: 30 min");}catch(a){p.setType(p.TYPE_FAILURE).setContents(a.message).setResult()}}});(new MS.Events).addKeyUp(b,function(d){!0===(new MS.Keyboard).setEvent(d).setResult().isEnter()&&MS.Events().produceBlur(b)})});
return c}};
