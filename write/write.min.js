var MS=MS||{};
MS.Write=function(){function t(c,l){return Math.floor(Math.random()*(l-c+1))+c}function A(c,l){var m=c.length-1,d=t(0,m);" "===c[d]&&(d=t(0,m));c[d]=l;return c}var n=this,B,I=document.getElementsByClassName("writing-workspace")[0],J=document.getElementsByClassName("popup")[0],u=0,C=0,D=0,v;n.setParent=function(c){B=c;return n};n.setOption=function(c){v=c;return n};n.setResult=function(){var c=B.getElementsByClassName("wr"),l=(new MS.StageProgress).setParent(document).setTotal(c.length).setOnReset(function(){D=C=
0;(new MS.ForEach).setCollection(c).setResult(function(m,d){d.classList.remove("s1");d.classList.remove("s2")})}).setResult();(new MS.ForEach).setCollection(c).setResult(function(m,d){var w=d.parentNode.parentNode,p=[],E="",F="";m=w.getElementsByTagName("a");(new MS.ForEach).setCollection(m).setResult(function(a,f){a=f.textContent.split("");p=p.concat(a);E+=f.textContent;var g="";switch(v){case "missing letter":g+=A(a,"...").join("");break;case "randomised letters":var k=t(0,a.length-1),e=k+1;void 0===
a[e]&&(e=k-1);var b=a[k];a[k]=a[e];a[e]=b;g+=a.join("");break;case "mistaken letter":k="abcdefghijklmnopqrstuvwxyz".split(""),e=t(0,k.length-1),a=A(a,k[e]),g+=a.join("")}""!==g&&(f.textContent=g,F+=g)});MS.Events().addClick(d,function(a){if(1===d.classList.length){var f=0,g=0;w.classList.add("s1");a=I.cloneNode(!0);var k=a.children[0],e=a.children[1],b=a.children[2],q=a.children[3],x=q.children[0];q=q.children[1];q.textContent="default"===v?E:F;var K=b.getAttribute("data-placeholder"),G=(new MS.PlaceHolder).setElement(b).setText(K).setResult();
d.classList.add("s"+f);var L=(new MS.Popup).setTemplate(J).setOnUnsetResult(function(){0<f&&(d.classList.add("s"+f),1===f?l.setSuccess(++C):l.setFailure(++D),l.setResult());d.classList.remove("s0");w.classList.remove("s1");g=0}).setContent(a).setResult(function(h){});MS.Events().addFocus(b,function(h){G.unsetResult();1===u&&(u=0,MS.Events().produceClick(x))});MS.Events().addBlur(b,function(h){G.setResult()});MS.Events().addKeyUp(b,function(h){e.innerHTML="";""!==b.textContent&&(h=b.textContent.replace(/\s+/g,
" ").replace("."," .").trim().split(""),(new MS.ForEach).setCollection(h).setResult(function(r,H){var y=document.createElement("div");r=H===p[r]?"1":"2";f=4;y.classList.add("s"+r);y.textContent=H;e.appendChild(y)}),console.log(h),console.log(p),JSON.stringify(h)===JSON.stringify(p)?(e.innerHTML="",b.textContent="",window.service.audio.pause(),window.service.audio=new Audio,window.service.audio.src="/Dummy/Style/correct.mp3",window.service.audio.play(),k.children[g].classList.add("s1"),g+=1,f=0,3===
g&&(f=1,b.textContent=b.getAttribute("data-success"),b.removeAttribute("contenteditable"),e.innerHTML="",window.setTimeout(function(){L.unsetResult()},2E3))):(h=document.createTextNode("..."),e.appendChild(h),f=0))});var z=new MS.Relations;a=(new MS.Relation).setActivator(x).addDependant(q);z.addRelation(a);MS.Events().addClick(x,function(h){z.setEvent(h);z.setResult(function(r){!0===r?(u=1,b.textContent="",e.innerHTML="",MS.Events().produceKeyUp(b).produceBlur(b)):u=0})})}})});return n}};
